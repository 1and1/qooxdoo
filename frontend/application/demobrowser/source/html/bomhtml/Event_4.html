<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>qooxdoo &raquo; Demo Browser</title>
  <script type="text/javascript" src="../../script/demo.js"></script>
  <script type="text/javascript" src="../util.js"></script>
  <style type="text/css">

    #iframe {
      left: 10px;
      top; 10px;
      height: 600px;
      width: 800px;
      overflow: auto;
      border: 2px inset;
    }

    #moveable {
      position: absolute;
      top: 110px;
      left: 250px;
      width: 30px;
      height: 30px;
      border: 2px dashed red;
      background-color: white;
      opacity : 0.5;
      -moz-opacity: 0.5;
      z-index: 50;
      display: none;
    }

  </style>
</head>
<body>
  <div id="description">
    <p>Demonstrate that the new event handler works for iframes as well.</p>
  </div>

  <div id="moveable"></div>

  <script type="text/javascript">

qx.Class.define("BasicSample",
{
  extend : qx.application.Basic,

  members :
  {
    main : function()
    {
      this.base(arguments);
    },

    bindIFrameEvents : function()
    {
      var iframe = window.document.getElementById("iframe");
      var document = qx.legacy.html.Iframe.getDocument(iframe);

      this._juhu = document.getElementById("juhu");
      this._inner = document.getElementById("inner");

      qx.event.Registration.addListener(this._juhu, "contextmenu", this._preventDefault, this);
      qx.event.Registration.addListener(this._inner, "click", this._stopPropagation, this);
      qx.event.Registration.addListener(this._juhu, "click", this._onclick1, this);
      qx.event.Registration.addListener(this._juhu, "click", this._onclick2, this);

      qx.event.Registration.addListener(
        document.getElementById("input"),
        "keydown",
        this._onkeydown, this
      );

      for (var i=1; i<10; i++) {
        var div = document.getElementById("div"+i);
        qx.event.Registration.addListener(div, "click", this._cascadeCapture, this, true);
        qx.event.Registration.addListener(div, "click", this._cascadeBubble, this, false);
      }

      qx.event.Registration.addListener(
        document.getElementById("scroll"),
        "scroll",
        this.throttle(150, this._scroll, this),
        this
      );

      /*
      qx.event.Registration.addListener(
        document.documentElement,
        "click",
        this._positionDiv,
        this
      );
      */
    },


    throttle : function(minIntervalTime, fcn, self)
    {
      var timeoutId = 0;

      return function() {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(function() {
          self ? fcn.call(self) : fcn();
        }, minIntervalTime);
      }
    },

    _onkeydown: function(e) {
      this.debug("keydown: " + e.getKeyIdentifier());
    },

    _scroll: function(e) {
      this.debug("scroll");
    },

    _cascadeCapture : function(e) {
      var elem = e.getCurrentTarget();
      this.debug("capture: " + elem.id + " " + e.getEventPhase());
    },

    _cascadeBubble : function(e) {
      var elem = e.getCurrentTarget();
      this.debug("bubble: " + elem.id + " " + e.getEventPhase());
    },

    _preventDefault : function(e)
    {
      this.debug(e.getType() + ": " + e);
      e.preventDefault();
    },

    _stopPropagation : function(e)
    {
      this.debug(e.getType() + " (inner): " + e);
      e.stopPropagation();
    },


    _onclick1 : function(e)
    {
      this.debug(e.getType() + " 1: " +  e);
      qx.event.Registration.removeListener(this._juhu, "click", this._onclick1);
    },

    _onclick2 : function(e)
    {
      this.debug(e.getType() + " 2: " + e);
    },

    _positionDiv : function(e)
    {
      var div = document.getElementById("moveable");
      div.style.left = e.getViewportLeft() + "px";
      div.style.top = e.getViewportTop() + "px";
    }
  }
});

var APP = new BasicSample;
qx.core.Init.getInstance().setApplication(APP);

  </script>

  <iframe src="data/iframe.html" id="iframe" onload="APP.bindIFrameEvents()">
  </iframe>

</body>
</html>
