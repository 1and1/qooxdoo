<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>qooxdoo &raquo; Demo Browser</title>

  <script type="text/javascript">
  qxsettings = {
    "qx.enableApplicationLayout" : false,
    "qx.boxModelCorrection" : false
  };
  </script>

  <script type="text/javascript" src="../../script/demo.js"></script>
  <script type="text/javascript" src="../util.js"></script>
  <style type="text/css">

    #moveable {
      position: absolute;
      top: 110px;
      left: 250px;
      width: 29px;
      height: 29px;
      border: 2px dashed red;
      background-color: white;
      opacity : 0.5;
      -moz-opacity: 0.5;
      z-index: 50;
      display: none;
    }

    #juhu {
      width: 400px;
      margin: 10px;
      background-color: orange;
    }

    #inner, #juhu {
      border: 1px solid black;
      padding: 10px;
    }

    #div1 {
      width: 500px;
      margin: 10px;
    }

    .cascade {
      border: 1px solid black;
      padding: 10px;
    }

    #scroll {
      overflow: scroll;
      height: 100px;
      width: 100px;
    }

  </style>
</head>
<body>
  <div id="description">
    <p>Test of new event handler code.</p>
  </div>

  <div id="moveable">
    <div style="position:absolute;left:14px;top:0px; width:1px; height:29px; background-color:black;"></div>
    <div style="position:absolute;left:0px;top:14px; width:29px; height:1px; background-color:black;"></div>
  </div>

  <div id="juhu" tabindex="1">
    Juhu Kinners
    <div id="inner">Inner Div</div>
  </div>


  <div class="cascade" id="div1">1
    <div class="cascade" id="div2">2
      <div class="cascade" id="div3">3
        <div class="cascade" id="div4">4
          <div class="cascade" id="div5">5
            <div class="cascade" id="div6">6
              <div class="cascade" id="div7">7
                <div class="cascade" id="div8">8
                  <div class="cascade" id="div9">9
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <input type="text" id="input"></input>

  <div id="scroll">
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  </div>

  <script type="text/javascript">

qx.Class.define("BasicSample",
{
  extend : qx.application.Basic,

  members :
  {
    main : function()
    {
      this.base(arguments);
      
      qx.event.Manager.addListener(window, "resize", this._onResize, this);

      var cmd = new qx.event.Command("Shift-Meta-F1");
      cmd.addEventListener("execute", function() {
        this.debug(cmd.toString());
      }, this);

      var cmd2 = new qx.event.Command("Ctrl-A");
      cmd2.addEventListener("execute", function() {
        this.debug(cmd2.toString());
      }, this);

      this._juhu = document.getElementById("juhu");
      this._inner = document.getElementById("inner");

      qx.event.Manager.addListener(this._juhu, "contextmenu", this._preventDefault, this);
      qx.event.Manager.addListener(this._inner, "click", this._stopPropagation, this);
      qx.event.Manager.addListener(this._juhu, "click", this._onclick1, this);
      qx.event.Manager.addListener(this._juhu, "click", this._onclick2, this);
      qx.event.Manager.addListener(this._juhu, "keydown", this._onclick2, this);

      qx.event.Manager.addListener(
        document.getElementById("input"),
        "keydown",
        this._onkeydown, this
      );

      qx.event.Manager.addListener(
        document.getElementById("input"),
        "keyinput",
        this._onkeyinput, this
      );

      for (var i=1; i<10; i++) {
        var div = document.getElementById("div"+i);
        qx.event.Manager.addListener(div, "click", this._cascadeCapture, this, true);
        qx.event.Manager.addListener(div, "click", this._cascadeBubble, this, false);
      }

      qx.event.Manager.addListener(
        document.getElementById("scroll"),
        "scroll",
        this._scroll,
        this
      );

      //qx.event.Manager.addListener(document.documentElement, "click", this._positionDiv, this);

      qx.event.Manager.addListener(this._juhu, "click", function() {
        var e = qx.event.Pool.getInstance().getEventInstance("qx.event.type.Event").init({});
        e.setType("juhu");
        e.setCurrentTarget(this);
        e.setTarget(this);
        qx.event.Manager.getManager(this).dispatchEvent(e);
        qx.event.Pool.getInstance().poolEvent(e);
      }, this);

      // Does not seem to work
      // qx.event.Manager.addListener(this, "juhu", this._onJuhu, this);

      qx.event.Manager.addListener(document.getElementById("div9"), "mousewheel", function(e)
      {
        this.debug("wheel: " + e.getTarget().id + " " + e.getWheelDelta());
      }, this);

    },
    
    _onResize : function(e) {
      this.debug("Resize:" + e);
    },

    _onJuhu : function(e) {
      this.debug("Juhu:" + e);
    },

    _onkeydown: function(e) {
      this.debug("keydown: " + e.getKeyIdentifier());
    },

    _onkeyinput: function(e) {
      this.debug("keyinput: " + e.getCharCode());
    },

    _scroll: function(e) {
      this.debug("scroll:" + e.getTarget());
    },

    _cascadeCapture : function(e) 
    {
      var elem = e.getCurrentTarget();
      var title = e.getEventPhase() == 2 ? "at-target: " : "capture: ";
      
      this.debug(title + elem.id + " (capture-listener)");
    },

    _cascadeBubble : function(e) 
    {
      var elem = e.getCurrentTarget();
      var title = e.getEventPhase() == 2 ? "at-target: " : "bubble: ";
      
      this.debug(title + elem.id + " (bubble-listener)");
    },

    _preventDefault : function(e)
    {
      this.debug(e.getType() + ": " + e);
      e.preventDefault();
    },

    _stopPropagation : function(e)
    {
      this.debug(e.getType() + " (inner): " + e);
      e.stopPropagation();
    },


    _onclick1 : function(e)
    {
      this.debug(e.getType() + " 1: " +  e);
      qx.event.Manager.removeListener(this._juhu, "click", this._onclick1);
    },

    _onclick2 : function(e)
    {
      this.debug(e.getType() + " 2: " + e);
    },

    _positionDiv : function(e) {
      var div = document.getElementById("moveable");
      div.style.left = (e.getDocumentLeft() - 16) + "px";
      div.style.top = (e.getDocumentTop() -16) + "px";
    }

  }
});

qx.core.Init.getInstance().setApplication(new BasicSample);

  </script>
</body>
</html>
