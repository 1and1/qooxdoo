<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>qooxdoo &raquo; Demo Browser</title>

  <script type="text/javascript">
  qxsettings = {
    "qx.enableApplicationLayout" : false,
    "qx.boxModelCorrection" : false
  };
  </script>

  <script type="text/javascript" src="../../script/demo.js"></script>
  <script type="text/javascript" src="../util.js"></script>
  <style type="text/css">

    #moveable {
      position: absolute;
      top: 110px;
      left: 250px;
      width: 29px;
      height: 29px;
      border: 2px dashed red;
      background-color: white;
      opacity : 0.5;
      -moz-opacity: 0.5;
      z-index: 50;
    }

    #juhu {
      width: 400px;
      margin: 10px;
      background-color: orange;
    }

    #inner, #juhu {
      border: 1px solid black;
      padding: 10px;
    }

    #div1 {
      width: 500px;
      margin: 10px;
    }

    .cascade {
      border: 1px solid black;
      padding: 10px;
    }

    #scroll {
      overflow: scroll;
      height: 100px;
      width: 100px;
    }

  </style>
</head>
<body>
  <div id="description">
    <p>Test of new event handler code.</p>
  </div>

  <div id="moveable">
    <div style="position:absolute;left:14px;top:0px; width:1px; height:29px; background-color:black;"></div>
  <div style="position:absolute;left:0px;top:14px; width:29px; height:1px; background-color:black;"></div>
  </div>

  <div id="juhu" tabindex="1">
    Juhu Kinners
    <div id="inner">Inner Div</div>
  </div>


  <div class="cascade" id="div1">1
    <div class="cascade" id="div2">2
      <div class="cascade" id="div3">3
        <div class="cascade" id="div4">4
          <div class="cascade" id="div5">5
            <div class="cascade" id="div6">6
              <div class="cascade" id="div7">7
                <div class="cascade" id="div8">8
                  <div class="cascade" id="div9">9
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <input type="text" id="input"></input>

  <div id="scroll">
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners Juhu Kinners
  </div>

  <script type="text/javascript">

qx.Class.define("BasicSample",
{
  extend : qx.application.Basic,

  members :
  {
    main : function()
    {
      this.base(arguments);

      this._juhu = document.getElementById("juhu");
      this._inner = document.getElementById("inner");

      qx.event2.Manager.addListener(this._juhu, "contextmenu", this._preventDefault, this);
      qx.event2.Manager.addListener(this._inner, "click", this._stopPropagation, this);
      qx.event2.Manager.addListener(this._juhu, "click", this._onclick1, this);
      qx.event2.Manager.addListener(this._juhu, "click", this._onclick2, this);
      qx.event2.Manager.addListener(this._juhu, "keydown", this._onclick2, this);

      qx.event2.Manager.addListener(
        document.getElementById("input"),
        "keydown",
        this._onkeydown, this
      );

      for (var i=1; i<10; i++) {
        var div = document.getElementById("div"+i);
        qx.event2.Manager.addListener(div, "click", this._cascadeCapture, this, true);
        qx.event2.Manager.addListener(div, "click", this._cascadeBubble, this, false);
      }

      qx.event2.Manager.addListener(
        document.getElementById("scroll"),
        "scroll",
        this.throttle(150, this._scroll, this),
        this
      );

      qx.event2.Manager.addListener(
        document.documentElement,
        "click",
        this._positionDiv,
        this
      );

      qx.event2.Manager.addListener(window, "blur", this.__onBlurFocus, this);
      qx.event2.Manager.addListener(window, "focus", this.__onBlurFocus, this);

    },

    throttle : function(minIntervalTime, fcn, self)
    {
      var timeoutId = 0;

      return function() {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(function() {
          self ? fcn.call(self) : fcn();
        }, minIntervalTime);
      }
    },

    _onkeydown: function(e) {
      this.debug("keydown: " + e.getKeyIdentifier());
    },

    _scroll: function(e) {
      this.debug("scroll");
    },

    _cascadeCapture : function(e) {
      var elem = e.getCurrentTarget();
      this.debug("capture: " + elem.id + " " + e.getEventPhase());
    },

    _cascadeBubble : function(e) {
      var elem = e.getCurrentTarget();
      this.debug("bubble: " + elem.id + " " + e.getEventPhase());
    },

    _preventDefault : function(e)
    {
      this.debug(e.getType() + ": " + e);
      e.preventDefault();
    },

    _stopPropagation : function(e)
    {
      this.debug(e.getType() + " (inner): " + e);
      e.stopPropagation();
    },


    _onclick1 : function(e)
    {
      this.debug(e.getType() + " 1: " +  e);
      qx.event2.Manager.removeListener(this._juhu, "click", this._onclick1);
    },

    _onclick2 : function(e)
    {
      this.debug(e.getType() + " 2: " + e);
    },

    _positionDiv : function(e) {
      console.log(e);
      var div = document.getElementById("moveable");
      div.style.left = (e.getDocumentLeft() - 16) + "px";
      div.style.top = (e.getDocumentTop() -16) + "px";
    },

    __onBlurFocus : function(e) {
      console.log(e.getType(), e.getTarget(), e._dom.target);
    }

  }
});

qx.core.Init.getInstance().setApplication(new BasicSample);

  </script>
</body>
</html>
